#include "TileRenderMap.h"

using namespace NAMESPACE;
using namespace std;
using namespace sf;

TileRenderMap::TileRenderMap()
{
   // MUFFINS: move as much of this as possible to RenderData
   _tileSetTexture = Texture();
   _tileSetTexture.loadFromFile( "Resources/Textures/overworld_tileset.png" );
   _tileSetSize = Vector2i( 16, 10 ); // 512x320 pixels
   _tileSize = 32;

   _mapSize = Vector2i( 30, 20 ); // 960x640 pixels
   _rearMapTileIndexes = vector<int>( _mapSize.x * _mapSize.y, -1 );
   _frontMapTileIndexes = vector<int>( _mapSize.x * _mapSize.y, -1 );

   _tileSprite = Sprite( _tileSetTexture );
   _tileSpriteTextureRect = IntRect( 0, 0, _tileSize, _tileSize );
   _tileSpritePosition = Vector2f( 0, 0 );

   // MUFFINS: this will go in GameLoader eventually
   LoadTestMap();
}

int TileRenderMap::GetTileIndex( int mapX, int mapY, bool rearTile ) const
{
   return rearTile
      ? _rearMapTileIndexes[mapX + ( _mapSize.x * mapY )]
      : _frontMapTileIndexes[mapX + ( _mapSize.x * mapY )];
}

const Sprite& TileRenderMap::GetTileSprite( int tileIndex, float positionX, float positionY )
{
   _tileSpriteTextureRect.left = ( tileIndex % _tileSetSize.x ) * _tileSize;
   _tileSpriteTextureRect.top = ( tileIndex / _tileSetSize.x ) * _tileSize;
   _tileSprite.setTextureRect( _tileSpriteTextureRect );

   _tileSpritePosition.x = positionX;
   _tileSpritePosition.y = positionY;
   _tileSprite.setPosition( _tileSpritePosition );

   return _tileSprite;
}

void TileRenderMap::LoadTestMap()
{
   // 30x20
   _rearMapTileIndexes = {
       1,  1,  1,  1,  4,  1,  1,  1,  1,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  4,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  7,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  7,  7,  7,  7,  7,  7,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  7,  7, 14,  1,  1,  1,
       1,  1,  1,  1,  7,  7,  7,  7,  7,  7,  7,  7,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  7,  7,  7, 14,  1,  1,  4,
       1,  1,  1, 12,  7,  7,  7,  7,  7,  7,  7,  7, 14,  1,  1,  1,  1,  1,  1,  1,  1,  1,  7,  7,  7, 31, 10,  1,  1,  1,
       1,  1,  1, 12,  7,  7,  7,  7,  7,  7,  7,  7, 14,  1,  1,  1,  1,  1,  1,  1,  1, 12,  7,  7, 31, 10,  1,  1,  1,  1,
       3,  1,  1, 11, 32,  7,  7,  7,  7,  7,  7,  7, 14,  1,  1,  1,  1,  1,  1,  1,  1, 12,  7, 31, 10,  1,  1,  1,  1,  1,
       1,  1,  1,  1, 11, 15, 15, 15, 15, 15, 15, 15, 10,  5,  1,  1,  1,  1,  1,  1,  1, 11, 15, 10,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  6,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  6,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  4,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 42, 40, 40, 40, 40, 40, 42,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 42,  1,  1,  1,  1,  1, 42,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  2,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 42,  0,  2,  3,  1,  2, 42,  1,  1,  1,  1,  1,  1,  3,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 42,  1,  3,  0,  3,  0, 42,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 42,  0,  2,  1,  2,  3, 42,  1,  1,  3,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 42, 41, 41, 41, 41, 41, 42,  1,  1,  1,  1,  1,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1, 40, 40, 40, 40, 40, 40, 40,  1,  1,  1,  1,  6,  1,  1,  1,  1,
       1,  1,  1,  1,  1,  1,  1,  1,  1,  3,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  4,  1,  1,  1,  1,  1,  1,  1,  1
   };

   _frontMapTileIndexes = {
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 43, 13, 44, -1, -1, -1,
      -1, -1, -1, -1, 43, 13, 13, 13, 13, 13, 13, 44, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 43, 34, -1, 46, -1, -1, -1,
      -1, -1, -1, 43, 34, -1, -1, -1, -1, -1, -1, 37, 44, -1, -1, -1, -1, -1, -1, -1, -1, -1, 43, 34, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, 45, -1, -1, -1, -1, -1, -1, -1, -1, 46, -1, -1, -1, -1, -1, -1, -1, -1, 43, 34, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 45, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 39, 39, 39, 39, 39, 39, 39, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,
      -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1
   };
}
